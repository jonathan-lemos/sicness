!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).sicness=t()}}(function(){return function o(a,s,c){function u(e,t){if(!s[e]){if(!a[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(h)return h(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[e]={exports:{}};a[e][0].call(i.exports,function(t){return u(a[e][1][t]||t)},i,i.exports,o,a,s,c)}return s[e].exports}for(var h="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("./sicxe_cc")),o=function(t){var e=document.getElementById(t);if(null==e)throw new Error("Element "+t+" was not found in the DOM");return e};o("button_run").onclick=function(){try{var t=o("editor").innerText.split("\n"),e=new i.SicCompiler(t);o("output").innerText=e.lstReport().reduce(function(t,e){return t+"\n"+e})}catch(t){alert(t.message)}}},{"./sicxe_cc":2}],2:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.sicMakeMask=function(t){for(var e=0,n=0;n<t;++n)e|=1<<n;return e},o.sicCheckUnsigned=function(t,e){if(t<0||t>o.sicMakeMask(e))throw new Error(t.toString(16).toUpperCase()+" does not fit in an unsigned "+e+"-bit range")},o.sicMakeUnsigned=function(t,e){var n=o.sicMakeMask(e-1);if(t<-n-1||n<t)throw new Error(t.toString(16).toUpperCase()+" does not fit in a signed "+e+"-bit range");return t>>>=0,t&=o.sicMakeMask(e)};var l=function(t){var e=(t=t.replace(/\..*$/,"").toUpperCase()).split(/\s+/);if(e.length<=1)throw new Error("This line does not have the correct number of entries. Did you forget to put whitespace before the operand?");this.tag=e[0],this.op=e[1],3<=e.length?this.args=e.slice(2).reduce(function(t,e){return t+e}):this.args=""};o.SicSplit=l;var n=function(t,e,n){this.mnemonic=t,this.opcode=e,this.format=n};o.SicBytecode=n,o.bytecodeTable={ADD:new n("ADD",24,3),ADDF:new n("ADDF",88,3),ADDR:new n("ADDR",144,2),AND:new n("AND",64,3),CLEAR:new n("CLEAR",180,2),COMP:new n("COMP",40,3),COMPF:new n("COMPF",136,3),COMPR:new n("COMPR",160,2),DIV:new n("DIV",36,3),DIVF:new n("DIVF",100,3),DIVR:new n("DIVR",156,2),FIX:new n("FIX",196,1),FLOAT:new n("FLOAT",192,1),HIO:new n("HIO",244,1),J:new n("J",60,3),JEQ:new n("JEQ",48,3),JLT:new n("JLT",56,3),JSUB:new n("JSUB",72,3),LDA:new n("LDA",0,3),LDB:new n("LDB",104,3),LDCH:new n("LDCH",80,3),LDF:new n("LDF",112,3),LDL:new n("LDL",8,3),LDS:new n("LDS",108,3),LDT:new n("LDT",116,3),LDX:new n("LDX",4,3),LPS:new n("LPS",208,3),MUL:new n("MUL",32,3),MULF:new n("MULF",96,3),MULR:new n("MULR",152,2),NORM:new n("NORM",200,1),OR:new n("OR",68,3),RD:new n("RD",216,3),RMO:new n("RMO",172,2),RSUB:new n("RSUB",76,3),SHIFTL:new n("SHIFTL",164,2),SHIFTR:new n("SHIFTR",168,2),SIO:new n("SIO",240,1),SSK:new n("SSK",236,3),STA:new n("STA",12,3),STB:new n("STB",120,3),STCH:new n("STCH",84,3),STF:new n("STF",128,3),STI:new n("STI",212,3),STS:new n("STS",124,3),STSW:new n("STSW",232,3),STT:new n("STT",132,3),STX:new n("STX",16,3),SUB:new n("SUB",28,3),SUBF:new n("SUBF",92,3),SUBR:new n("SUBR",148,2),SVC:new n("SVC",176,2),TD:new n("TD",224,3),TIO:new n("TIO",248,1),TIX:new n("TIX",44,3),TIXR:new n("TIXR",184,2),WD:new n("WD",220,3)};var r=function(){function t(t){this.val=t,this.val instanceof d&&"number"==typeof this.val.val&&(this.val=this.val.val)}return t.prototype.ready=function(){return"number"==typeof this.val},t.prototype.makeReady=function(t){if("number"!=typeof this.val){"number"==typeof t&&(this.val=t);var e=t,n=this.val;this.val=n.convert(e,null)}},t}();o.SicBase=r;var p,i,f,a,d=function(){function t(t){this.val=t}return t.prototype.isLiteral=function(){return"number"==typeof this.val},t.prototype.isTag=function(){return"string"==typeof this.val},t.prototype.convert=function(t,e){var n;if("number"==typeof this.val){if(null===e)throw new Error("litTab is undefined but this SicPending is a literal");if(null===(n=e.getLitLoc(this.val)))throw new Error(this.val+"was not found in the literal table")}else{if(null===t)throw new Error("tagTab is undefined but this SicPending is a tag");if(null===(n=t[this.val]))throw new Error(this.val+"was not found in the tag table")}return n},t}();o.SicPending=d,(i=p=o.SicOpAddrType||(o.SicOpAddrType={}))[i.immediate=0]="immediate",i[i.direct=1]="direct",i[i.indirect=2]="indirect",(a=f=o.SicOpType||(o.SicOpType={}))[a.f3=0]="f3",a[a.f4=1]="f4",a[a.legacy=2]="legacy";var s=function(){function t(t,e,n,r){var i,o=new RegExp("^(=|#|@)?(\\d+)(,X)?$"),a=new RegExp("^(=|#|@)?X'([0-9A-F]+)'(,X)?$"),s=new RegExp("^(=|#|@)?C'(.)'(,X)?$"),c=new RegExp("^(#|@)?([A-Z0-9]+)(,X)?$"),u=function(t){switch(t){case"#":return p.immediate;case"@":return p.indirect;case"=":default:return p.direct}},h=function(t){return void 0!==t&&"="===t.charAt(0)};if(this.type=e,this.base=this.type===f.f3?r:void 0,this.pcrel=this.type===f.f3,null!==(i=t.match(o))){var l=parseInt(i[2],10);h(i[1])?(n.add(l),this.val=new d(l)):(this.val=l,this.pcrel=!1),this.addr=u(i[1]),this.indexed=null!=i[3]}else if(null!==(i=t.match(a))){l=parseInt(i[2],16);h(i[1])?(n.add(l),this.val=new d(l)):(this.val=l,this.pcrel=!1),this.addr=u(i[1]),this.indexed=null!=i[3]}else if(null!==(i=t.match(s))){l=i[2].charCodeAt(0);h(i[1])?(n.add(l),this.val=new d(l)):(this.val=l,this.pcrel=!1),this.addr=u(i[1]),this.indexed=null!=i[3]}else{if(null==(i=t.match(c)))throw new Error("Operand "+t+" is not of any valid format.");this.val=new d(i[2]),this.addr=u(i[1]),this.indexed=null!=i[3]}if(this.addr!==p.direct&&this.type===f.legacy)throw new Error("SIC Legacy instructions can only use direct addressing");this.rdy=!this.pcrel&&void 0===this.base&&"number"==typeof this.val}return t.prototype.ready=function(){return this.rdy},t.prototype.makeReady=function(t,e,n){if(!this.rdy){var r;switch(void 0===this.base||this.base.ready()||this.base.makeReady(e),"number"!=typeof this.val&&(this.val=this.val.convert(e,n)),this.type){case f.f3:r=12;break;case f.legacy:r=15;break;case f.f4:r=20;break;default:throw new Error("type is not valid")}if(this.pcrel)try{return this.val=o.sicMakeUnsigned(this.val-t,r),void(this.rdy=!0)}catch(t){this.pcrel=!1}if(this.base)try{return this.val=o.sicMakeUnsigned(this.val-this.base.val,r),void(this.rdy=!0)}catch(t){this.base=void 0}o.sicCheckUnsigned(this.val,r),this.rdy=!0}},t.prototype.nixbpe=function(){var t,e,n=this.indexed,r=!this.pcrel&&void 0!==this.base,i=this.pcrel,o=this.type!==f.f3;switch(this.addr){case p.direct:e=t=!0;break;case p.indirect:e=!(t=!0);break;case p.immediate:e=!(t=!1);break;default:throw new Error("Registers do not have an nixbpe value")}var a=[0,0];return t&&(a[0]|=2),e&&(a[0]|=1),n&&(a[1]|=128),r&&(a[1]|=64),i&&(a[1]|=32),o&&(a[1]|=16),a},t}();o.SicOperandAddr=s;var w=function(){function e(t){if(!e.isFormat1(t.op))throw new Error(t.op+" is not a format 1 operation");if(""!==t.args)throw new Error("Format 1 arguments cannot have arguments");this.bc=o.bytecodeTable[t.op]}return e.isFormat1=function(t){var e=o.bytecodeTable[t];return void 0!==e&&1===e.format},e.prototype.ready=function(){return!0},e.prototype.makeReady=function(t,e,n){},e.prototype.length=function(){return 1},e.prototype.toBytes=function(){return[this.bc.opcode]},e}();o.SicFormat1=w;var v=function(){function r(t){if(!r.isFormat2(t.op))throw new Error(t.op+" is not a format 2 opcode");this.bc=o.bytecodeTable[t.op];var e=t.args.trim().split(/\s*,\s*/);if(2!==e.length)throw new Error("Args needs to have 2 and only 2 values.");var n=function(t){new RegExp("^(.+),X$");var e,n=new RegExp("^(A|X|L|PC|SW|B|S|T|F)$"),r=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^([0-9]+)$");if(null!==(e=t.match(n)))return o.sicRegToDec(e[1]);if(null!==(e=t.match(r)))return parseInt(e[1],16);if(null!==(e=t.match(i)))return parseInt(e[1],10);throw new Error(t+" is not a valid format 2 operand.")};this.op1=n(e[0]),o.sicCheckUnsigned(this.op1,4),this.op2=n(e[1]),o.sicCheckUnsigned(this.op2,4)}return r.isFormat2=function(t){var e=o.bytecodeTable[t];return void 0!==e&&2===e.format},r.prototype.ready=function(){return!0},r.prototype.makeReady=function(t,e,n){},r.prototype.length=function(){return 2},r.prototype.toBytes=function(){var t=[0,0];return t[0]=this.bc.opcode,t[1]|=(15&this.op1)<<4,t[1]|=15&this.op2,t},r}();o.SicFormat2=v;var b=function(){function r(t,e,n){if(!r.isFormat3(t.op))throw new Error(t.op+" is not format 3");this.bc=o.bytecodeTable[t.op],this.op=new s(t.args,f.f3,e,n)}return r.isFormat3=function(t){var e=o.bytecodeTable[t];return void 0!==e&&3===e.format},r.prototype.makeReady=function(t,e,n){this.op.makeReady(t+3,e,n)},r.prototype.ready=function(){return this.op.ready()},r.prototype.length=function(){return 3},r.prototype.toBytes=function(){if(!this.ready())throw new Error("MY BODY IS NOT READY");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(3840&this.op.val)>>>8,t[2]=255&this.op.val,t},r}();o.SicFormat3=b;var y=function(){function n(t,e){if(!n.isFormatLegacy(t.op))throw new Error(t.op+" is not SIC legacy format");this.bc=o.bytecodeTable[t.op],this.op=new s(t.args,f.legacy,e)}return n.isFormatLegacy=function(t){if("*"!==t.charAt(0))return!1;var e=o.bytecodeTable[t.slice(1)];return void 0!==e&&3===e.format},n.prototype.makeReady=function(t,e,n){this.op.makeReady(t+this.length(),e,n)},n.prototype.ready=function(){return this.op.ready()},n.prototype.length=function(){return 3},n.prototype.toBytes=function(){if(!this.ready())throw new Error("MY BODY IS NOT READY");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(3840&this.op.val)>>>8,t[2]=255&this.op.val,t},n}();o.SicFormatLegacy=y;var g=function(){function n(t,e){if(!n.isFormat4(t.op))throw new Error(t.op+" is not format 4");this.bc=o.bytecodeTable[t.op.slice(1)],this.op=new s(t.args,f.f4,e)}return n.isFormat4=function(t){if("+"!==t.charAt(0))return!1;var e=o.bytecodeTable[t.slice(1)];return void 0!==e&&3===e.format},n.prototype.makeReady=function(t,e,n){this.op.makeReady(t+this.length(),e,n)},n.prototype.ready=function(){return this.op.ready()},n.prototype.length=function(){return 4},n.prototype.toBytes=function(){if(!this.ready())throw new Error("MY BODY IS NOT READY");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(983040&this.op.val)>>>16,t[2]=(65280&this.op.val)>>>8,t[3]=255&this.op.val,t},n}();o.SicFormat4=g;var T=function(){function a(t){if(!a.isSpace(t.op))throw new Error("This mnemonic is not a space.");this.mnemonic=t.op;var e,n=new RegExp("^(\\d+)$"),r=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^C'(.+)'$");if(null!==(e=t.args.match(n)))this.arg=a.splitWord(parseInt(e[1],10));else if(null!==(e=t.args.match(r)))this.arg=a.splitWord(parseInt(e[1],16));else{if(null===(e=t.args.match(i)))throw new Error(t.args+" is not a valid operand format.");this.arg=[];for(var o=0;o<e[1].length;++o)this.arg.push(e[1].charCodeAt(o))}}return a.isSpace=function(t){return new RegExp("^(WORD|BYTE)$").test(t)},a.splitWord=function(t){return o.sicCheckUnsigned(t,24),[(16711680&t)>>>16,(65280&t)>>>8,255&t]},a.makeWord=function(t){if(3<t.length)throw new Error("Words can have a max of 3 bytes");for(var e=0,n=t.length-1,r=0;0<=n;--n,r+=8)e+=t[n]<<r;return e},a.prototype.ready=function(){return!0},a.prototype.makeReady=function(t,e,n){},a.prototype.length=function(){switch(this.mnemonic){case"WORD":return this.arg.length+(this.arg.length%3!=0?1:0);case"BYTE":return this.arg.length;default:throw new Error(this.mnemonic+" is invalid. this is a ultra mega bug")}},a.prototype.toBytes=function(){var e=[];switch(this.mnemonic){case"WORD":for(var t=0;t<this.arg.length%3;++t)e.push(0);this.arg.forEach(function(t){return e.push(t)});case"BYTE":return this.arg;default:throw new Error("Mnemonic is invalid.")}},a}();o.SicSpace=T;var m=function(){function t(t,e){this.source=t,this.errmsg="string"==typeof e?(this.bcData=void 0,e):void(this.bcData=e)}return t.prototype.hasInstruction=function(){return void 0!==this.bcData&&void 0!==this.bcData.inst},t.prototype.byteCode=function(){if(void 0===this.bcData||void 0===this.bcData.inst)throw new Error("This SicLstEntry does not have an instruction in it");return this.bcData.inst.toBytes()},t.prototype.byteString=function(){if(void 0===this.bcData||void 0===this.bcData.inst)throw new Error("Cannot make a byteString() if there is no instruction.");return this.bcData.inst.toBytes().reduce(function(t,e){return t+e.toString(16).toUpperCase().padStart(2,"0")},"")},t}();o.SicLstEntry=m;var S=function(){function t(){this.ltorgs=[],this.pending=new Set}return t.prototype.getLitLoc=function(e,n){void 0===n&&(n=0);var r=Number.MAX_SAFE_INTEGER,i=null;return this.ltorgs.forEach(function(t){t.val===e&&r>Math.min(t.loc-n,t.loc)&&(r=Math.min(t.loc-n,t.loc),i=t.loc)}),i},t.prototype.createOrg=function(t){var e=t,n=[];this.pending.forEach(function(t){n.push({loc:e,val:t}),e+=3});return this.ltorgs=this.ltorgs.concat(n),this.pending=new Set,n},t.prototype.add=function(t){this.pending.add(t)},t}();o.SicLitTab=S;var E=function(){function t(t){this.ALOC=this.RLOC=this.startloc=t,this.useTab={},this.currentUse=""}return Object.defineProperty(t.prototype,"aloc",{get:function(){return this.ALOC},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rloc",{get:function(){return this.RLOC},enumerable:!0,configurable:!0}),t.prototype.inc=function(t){this.RLOC+=t,this.ALOC+=t},t.prototype.use=function(t){this.useTab[this.currentUse]=this.RLOC,this.currentUse=t;var e=this.useTab[t];void 0===e&&(e=this.startloc),this.RLOC=e},t}();o.SicUseTab=E;var c=function(){function t(t){var c,u=this;this.lst=[],this.tagTab={},this.equTab={},this.useTab=new E(0),this.litTab=new S;var n=function(t){var e,n=new RegExp("^(\\d+)$"),r=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^C'.{1,3}'$");if(null!==(e=t.match(n)))return parseInt(e[1],10);if(null!==(e=t.match(r)))return parseInt(e[1],16);if(null===(e=t.match(i)))throw new Error(t+" was not of a valid numeric format.");for(var o=0,a=0,s=e[1];""!==s;a+=8,s=s.slice(0,-1))o+=s.charCodeAt(s.length-1)<<a;return o},h={RESW:function(t,e){u.lst.push(new m(t,{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0})),u.useTab.inc(3*n(e.args))},RESB:function(t,e){u.lst.push(new m(t,{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0})),u.useTab.inc(n(e.args))},START:function(t,e){if(0!==u.useTab.aloc)throw new Error("START can only be used as the first line of a program.");u.startName=e.tag,u.useTab=new E(parseInt(e.args,16)),u.lst.push(new m(t,{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0}))},END:function(t,e){if(e.args!==u.startName)throw new Error("END label must be the same as the start label.");u.lst.push(new m(t,{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0}))},BASE:function(t,e){try{c=new r(n(e.args))}catch(t){c=new r(new d(e.args))}u.lst.push(new m(t))},NOBASE:function(t,e){c=void 0,u.lst.push(new m(t))},LTORG:function(t,e){u.lst.push(new m(t)),u.litTab.createOrg(u.useTab.aloc).forEach(function(t){u.lst.push(new m("LTORG-WORD X'"+t.val.toString(16).toUpperCase()+"'",{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0})),u.useTab.inc(3)})},EQU:function(t,e){if(""===e.tag)throw new Error("EQU needs a non-empty label.");if(void 0!==u.equTab[e.args])throw new Error("EQU "+e.args+" was already defined.");u.equTab[e.tag]=e.args,u.lst.push(new m(t))},USE:function(t,e){u.useTab.use(e.args),u.lst.push(new m(t))}};(t.forEach(function(e){try{if(""===e.replace(/\..*$/,"").trim())return;var t=new l(e),n=void 0;t.args.replace(/(#|@|=)\*$/,"$1"+u.useTab.aloc.toString(10));for(var r=0,i=Object.keys(u.equTab);r<i.length;r++){var o=i[r];if(null!==t.args.match(o)){for(var a=u.equTab[o];void 0!==a;a=u.equTab[a])t.args=t.args.replace(o,u.equTab[o]);break}}if(void 0!==t.tag&&(u.tagTab[t.tag]=u.useTab.aloc),s=t.op,void 0!==h[s])return void h[t.op](e,t);if(w.isFormat1(t.op))n=new w(t);else if(v.isFormat2(t.op))n=new v(t);else if(b.isFormat3(t.op))n=new b(t,u.litTab.pending,c);else if(g.isFormat4(t.op))n=new g(t,u.litTab.pending);else if(y.isFormatLegacy(t.op))n=new y(t,u.litTab.pending);else{if(!T.isSpace(t.op))throw new Error(t.op+" is not a valid mnemonic.");n=new T(t)}u.lst.push(new m(e,{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:n})),u.useTab.inc(n.length())}catch(t){u.lst.push(new m(e,t.message))}var s}),0<this.litTab.pending.size)&&(this.litTab.createOrg(this.useTab.aloc).forEach(function(t){null===u.litTab.getLitLoc(t.val)&&(u.lst.push(new m("LTORG-WORD X'"+t.val.toString(16).toUpperCase()+"'",{aloc:u.useTab.aloc,rloc:u.useTab.rloc,inst:void 0})),u.useTab.inc(3))}),this.litTab.pending=new Set);this.lst.forEach(function(t){void 0===t.bcData||void 0===t.bcData.inst||t.bcData.inst.ready()||t.bcData.inst.makeReady(t.bcData.aloc,u.tagTab,u.litTab)})}return t.prototype.lstReport=function(){var t=["n"];t[0]="n    \taloc \trloc \tbytecode\tsource",t[1]="-----\t-----\t-----\t--------\t------";var o=1;return t.concat(this.lst.map(function(t){var e=void 0===t.bcData?"":t.bcData.aloc.toString(16).toUpperCase(),n=void 0===t.bcData?"":t.bcData.rloc.toString(16).toUpperCase(),r=t.hasInstruction()?t.byteString():"",i=o.toString(16).toUpperCase();return++o,i.padEnd(5," ")+"\t"+e.padEnd(5," ")+"\t"+n.padEnd(5," ")+"\t"+r.padEnd(8," ")+"\t"+t.source}))},t.prototype.toBytes=function(){return this.lst.filter(function(t){return t.hasInstruction()}).map(function(t){return t.byteCode()})},t}();o.SicCompiler=c,o.sicRegToDec=function(t){switch(t){case"A":return 0;case"X":return 1;case"L":return 2;case"B":return 3;case"S":return 4;case"T":return 5;case"F":return 6;case"PC":return 8;case"SW":return 9;default:throw new Error("reg type "+t+" is not valid")}},o.sicDecToReg=function(t){switch(t){case 0:return"A";case 1:return"X";case 2:return"L";case 3:return"B";case 4:return"S";case 5:return"T";case 6:return"F";case 8:return"PC";case 9:return"SW";default:throw new Error("reg no "+t+" is not valid")}}},{}]},{},[1])(1)});
//# sourceMappingURL=sicness.min.js.map
