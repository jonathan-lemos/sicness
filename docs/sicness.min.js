!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).sicness=t()}}(function(){return function o(a,c,s){function u(e,t){if(!c[e]){if(!a[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(d)return d(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=c[e]={exports:{}};a[e][0].call(i.exports,function(t){return u(a[e][1][t]||t)},i,i.exports,o,a,c,s)}return c[e].exports}for(var d="function"==typeof require&&require,t=0;t<s.length;t++)u(s[t]);return u}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicPending"),i=function(){function t(t){this.val=t,this.val instanceof n.SicPending&&"number"==typeof this.val.val&&(this.val=this.val.val)}return t.prototype.ready=function(){return"number"==typeof this.val},t.prototype.makeReady=function(t){if("number"!=typeof this.val)if("number"!=typeof t){var e=t,r=this.val;this.val=r.convert(e,null)}else this.val=t},t}();r.SicBase=i},{"./SicPending":15}],2:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e,r){this.mnemonicPvt=t,this.opcodePvt=e,this.formatPvt=r}return Object.defineProperty(t.prototype,"mnemonic",{get:function(){return this.mnemonicPvt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opcode",{get:function(){return this.opcodePvt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this.formatPvt},enumerable:!0,configurable:!0}),t}();r.SicBytecode=n,r.bytecodeTable={};var i=function(t){Object.defineProperty(r.bytecodeTable,t.mnemonic,{configurable:!0,enumerable:!0,value:t,writable:!1})};i(new n("ADD",24,3)),i(new n("ADDF",88,3)),i(new n("ADDR",144,2)),i(new n("AND",64,3)),i(new n("CLEAR",180,2)),i(new n("COMP",40,3)),i(new n("COMPF",136,3)),i(new n("COMPR",160,2)),i(new n("DIV",36,3)),i(new n("DIVF",100,3)),i(new n("DIVR",156,2)),i(new n("FIX",196,1)),i(new n("FLOAT",192,1)),i(new n("HIO",244,1)),i(new n("J",60,3)),i(new n("JEQ",48,3)),i(new n("JGT",52,3)),i(new n("JLT",56,3)),i(new n("JSUB",72,3)),i(new n("LDA",0,3)),i(new n("LDB",104,3)),i(new n("LDCH",80,3)),i(new n("LDF",112,3)),i(new n("LDL",8,3)),i(new n("LDS",108,3)),i(new n("LDT",116,3)),i(new n("LDX",4,3)),i(new n("LPS",208,3)),i(new n("MUL",32,3)),i(new n("MULF",96,3)),i(new n("MULR",152,2)),i(new n("NORM",200,1)),i(new n("OR",68,3)),i(new n("RD",216,3)),i(new n("RMO",172,2)),i(new n("RSUB",76,3)),i(new n("SHIFTL",164,2)),i(new n("SHIFTR",168,2)),i(new n("SIO",240,1)),i(new n("SSK",236,3)),i(new n("STA",12,3)),i(new n("STB",120,3)),i(new n("STCH",84,3)),i(new n("STF",128,3)),i(new n("STI",212,3)),i(new n("STL",20,3)),i(new n("STS",124,3)),i(new n("STSW",232,3)),i(new n("STT",132,3)),i(new n("STX",16,3)),i(new n("SUB",28,3)),i(new n("SUBF",92,3)),i(new n("SUBR",148,2)),i(new n("SVC",176,2)),i(new n("TD",224,3)),i(new n("TIO",248,1)),i(new n("TIX",44,3)),i(new n("TIXR",184,2)),i(new n("WD",220,3))},{}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicCsect"),s=t("./SicFormat1"),u=t("./SicFormat2"),d=t("./SicFormat3"),f=t("./SicFormat4"),l=t("./SicFormatLegacy"),h=t("./SicLstEntry"),p=t("./SicSpace"),b=t("./SicSplit"),i=function(){function t(t){var c=this;this.ctab=new n.SicCsectTab,this.errflag=!1,t.forEach(function(e){try{if(""===e.replace(/\..*$/,"").trim())return;var t=new b.SicSplit(e),r=void 0;t.args.replace(/(#|@|=)\*$/,"$1"+c.ctab.current.useTab.aloc.toString(10));for(var n=0,i=Object.keys(c.ctab.current.equTab);n<i.length;n++){var o=i[n];if(null!==t.args.match(o)){for(var a=c.ctab.current.equTab[o];void 0!==a;a=c.ctab.current.equTab[a])t.args=t.args.replace(o,c.ctab.current.equTab[o]);break}}if(""!==t.tag){if(void 0!==c.ctab.current.tagTab[t.tag])throw new Error("Duplicate label "+t.tag);c.ctab.current.tagTab[t.tag]=c.ctab.current.useTab.aloc}if(c.ctab.isDirective(t.op))return void c.ctab.directives[t.op](e,t);if(s.SicFormat1.isFormat1(t.op))r=new s.SicFormat1(t);else if(u.SicFormat2.isFormat2(t.op))r=new u.SicFormat2(t);else if(d.SicFormat3.isFormat3(t.op))r=new d.SicFormat3(t,c.ctab.current);else if(f.SicFormat4.isFormat4(t.op))r=new f.SicFormat4(t,c.ctab.current);else if(l.SicFormatLegacy.isFormatLegacy(t.op))r=new l.SicFormatLegacy(t,c.ctab.current);else{if(!p.SicSpace.isSpace(t.op))throw new Error(t.op+" is not a valid mnemonic.");r=new p.SicSpace(t)}c.ctab.addLst(new h.SicLstEntry(e,{aloc:c.ctab.current.useTab.aloc,rloc:c.ctab.current.useTab.rloc,inst:r})),c.ctab.current.useTab.inc(r.length())}catch(t){c.errflag=!0,c.ctab.addLst(new h.SicLstEntry(e,t.message))}}),this.ctab.forEach(function(t){t.litTab.hasPending()&&c.ctab.directives.LTORG("AUTO-LTORG",new b.SicSplit("\tAUTO-LTORG"))}),this.ctab.forEach(function(e){e.lst.forEach(function(t){void 0===t.bcData||void 0===t.bcData.inst||t.bcData.inst.ready()||t.bcData.inst.makeReady(t.bcData.aloc,e.tagTab,e.litTab)})})}return t.prototype.makeLst=function(){return this.ctab.makeLst()},t.prototype.makeObj=function(){return this.ctab.makeObj()},Object.defineProperty(t.prototype,"err",{get:function(){return this.errflag},enumerable:!0,configurable:!0}),t}();r.SicCompiler=i},{"./SicCsect":4,"./SicFormat1":6,"./SicFormat2":7,"./SicFormat3":8,"./SicFormat4":9,"./SicFormatLegacy":10,"./SicLstEntry":13,"./SicSpace":17,"./SicSplit":18}],4:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./SicBase"),d=t("./SicFmt"),o=t("./SicLiteral"),n=t("./SicLitTab"),a=t("./SicLstEntry"),c=t("./SicPending"),s=t("./SicUseTab"),u=function(){function t(t){this.lst=[],this.litTab=new n.SicLitTab,this.tagTab={},this.equTab={},this.useTab=new s.SicUseTab(t),this.extDefTab=new Set,this.extRefTab=new Set,this.modRecs=[]}return t.prototype.setStartAddr=function(t){this.useTab=new s.SicUseTab(t)},t}();r.SicCsect=u;var f=function(){function t(){var n=this;this.currentSect="",this.csects={},this.csects[this.currentSect]=new u(0),this.lst=[];var r=function(t){var e,r=new RegExp("^(\\d+)$"),n=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^C'.{1,3}'$");if(null!==(e=t.match(r)))return parseInt(e[1],10);if(null!==(e=t.match(n)))return parseInt(e[1],16);if(null===(e=t.match(i)))throw new Error(t+" was not of a valid numeric format.");for(var o=0,a=0,c=e[1];""!==c;a+=8,c=c.slice(0,-1))o+=c.charCodeAt(c.length-1)<<a;return o};this.directives={RESW:function(t,e){n.addLst(new a.SicLstEntry(t,{aloc:n.current.useTab.aloc,rloc:n.current.useTab.rloc,inst:void 0})),n.current.useTab.inc(3*r(e.args))},RESB:function(t,e){n.addLst(new a.SicLstEntry(t,{aloc:n.current.useTab.aloc,rloc:n.current.useTab.rloc,inst:void 0})),n.current.useTab.inc(r(e.args))},START:function(t,e){if(""!==n.currentSect||0!==n.current.lst.length)throw new Error("START can only be used as the first line of a program.");n.current.setStartAddr(parseInt(e.args,16)),n.addLst(new a.SicLstEntry(t,{aloc:n.current.useTab.aloc,rloc:n.current.useTab.rloc,inst:void 0})),n.startData={name:e.tag,loc:n.current.useTab.aloc}},END:function(t,e){if(n.csect(""),void 0===n.startData&&""!==e.args||void 0!==n.startData&&e.args!==n.startData.name)throw new Error("END label must be the same as the start label.");n.addLst(new a.SicLstEntry(t,{aloc:n.current.useTab.aloc,rloc:n.current.useTab.rloc,inst:void 0}))},BASE:function(t,e){try{n.current.base=new i.SicBase(r(e.args))}catch(t){n.current.base=new i.SicBase(new c.SicPending(e.args))}n.addLst(new a.SicLstEntry(t))},NOBASE:function(t,e){n.current.base=void 0,n.addLst(new a.SicLstEntry(t))},LTORG:function(t,e){n.addLst(new a.SicLstEntry(t)),n.current.litTab.createOrg(n.current.useTab.aloc).forEach(function(t){n.addLst(new a.SicLstEntry("LTORG-WORD X'"+d.asHex(t.val)+"'",{aloc:n.current.useTab.aloc,rloc:n.current.useTab.rloc,inst:new o.SicLiteral(t.val)})),n.current.useTab.inc(3)})},EQU:function(t,e){if(""===e.tag)throw new Error("EQU needs a non-empty label.");if(void 0!==n.current.equTab[e.args])throw new Error("EQU "+e.args+" was already defined.");n.current.equTab[e.tag]=e.args,n.addLst(new a.SicLstEntry(t))},USE:function(t,e){n.current.useTab.use(e.args),n.addLst(new a.SicLstEntry(t))},CSECT:function(t,e){n.addLst(new a.SicLstEntry(t)),n.csect(e.tag)},EXTDEF:function(t,e){var r=e.args.split(",");n.addLst(new a.SicLstEntry(t)),r.forEach(function(t){if(void 0===n.current.tagTab[t])throw new Error(t+" does not exist in the symbol table. Did you try to forward reference it?");n.current.extDefTab.add(t)})},EXTREF:function(t,e){var r=e.args.split(",");n.addLst(new a.SicLstEntry(t)),r.forEach(function(t){if(n.current.extRefTab.has(t))throw new Error("Duplicate EXTREF "+t);if(void 0!==n.current.tagTab[t])throw new Error("Duplicate label "+t);n.current.extRefTab.add(t)})}}}return t.prototype.isDirective=function(t){return void 0!==this.directives[t]},t.prototype.addLst=function(t){this.lst.push(t),this.current.lst.push(t)},t.prototype.makeLst=function(){var t=["n"];t[0]="n    \taloc \trloc \tbytecode\tsource",t[1]="-----\t-----\t-----\t--------\t------";var a=1;return t.concat(this.lst.map(function(t){var e=void 0===t.bcData?"":d.asHex(t.bcData.aloc),r=void 0===t.bcData?"":d.asHex(t.bcData.rloc),n=t.hasInstruction()?t.byteString():"",i=d.asHex(a);++a;var o=i.padEnd(5," ")+"\t"+e.padEnd(5," ")+"\t"+r.padEnd(5," ")+"\t"+n.padEnd(8," ")+"\t"+t.source;return void 0!==t.errmsg&&(o+="\n* Error: "+t.errmsg+" *"),o}))},t.prototype.makeObj=function(){var r=[],n=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=""),"H"+r+" "+d.asWord(e)+d.asWord(t)},i=function(t,e){if(0===t.size)return"";var r="D";return t.forEach(function(t){return r+=t+d.asWord(e[t])},""),r},o=function(t){if(0===t.size)return"";var e="R";return t.forEach(function(t){return e+=t+" "},""),e.trim()},a=function(t){var e=[];return t.forEach(function(t){void 0!==t.bcData&&void 0!==t.bcData.inst&&e.push("T"+d.asWord(t.bcData.aloc)+d.asByte(t.bcData.inst.length())+d.bytesToString(t.bcData.inst.toBytes()))}),e},c=function(t){return void 0===t?"E":"E"+d.asWord(t)},s=function(t){return t.map(function(t){return"M"+d.asWord(t.loc)+d.asByte(t.len)+"+"+t.symbol})},u=function(t){for(var e=0,r=0,n=0,i=t;n<i.length;n++){var o=i[n];if(void 0!==o.bcData){e=o.bcData.aloc;break}}for(var a=t.length-1;0<=a;--a){var c=t[a].bcData;if(void 0!==c){r=c.aloc+(void 0!==c.inst?c.inst.length():0);break}}return r-e},t=void 0!==this.startData?this.startData.loc:0,e=void 0!==this.startData?this.startData.name:"";return r.push(n(u(this.csects[""].lst),t,e)),r.push(i(this.csects[""].extDefTab,this.csects[""].tagTab)),r.push(o(this.csects[""].extRefTab)),(r=(r=r.concat(a(this.csects[""].lst))).concat(s(this.csects[""].modRecs))).push(c(t)),this.forEachAux(function(t,e){r.push(n(u(t.lst),0,e)),r.push(i(t.extDefTab,t.tagTab)),r.push(o(t.extRefTab)),(r=(r=r.concat(a(t.lst))).concat(s(t.modRecs))).push(c())}),r.filter(function(t){return""!==t})},Object.defineProperty(t.prototype,"current",{get:function(){return this.csects[this.currentSect]},enumerable:!0,configurable:!0}),t.prototype.csect=function(t){this.currentSect=t,void 0===this.csects[this.currentSect]&&(this.csects[this.currentSect]=new u(0))},Object.defineProperty(t.prototype,"default",{get:function(){return this.csects[""]},enumerable:!0,configurable:!0}),t.prototype.forEach=function(e){var r=this,t=this.currentSect;Object.keys(this.csects).forEach(function(t){r.currentSect=t,e(r.csects[t],t)}),this.currentSect=t},t.prototype.forEachAux=function(e){var r=this,t=this.currentSect;Object.keys(this.csects).forEach(function(t){""!==t&&(r.currentSect=t,e(r.csects[t],t))}),this.currentSect=t},t}();r.SicCsectTab=f},{"./SicBase":1,"./SicFmt":5,"./SicLitTab":11,"./SicLiteral":12,"./SicLstEntry":13,"./SicPending":15,"./SicUseTab":20}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.asHex=function(t){return t.toString(16).toUpperCase()},r.asWord=function(t){return r.asHex(t).padStart(6,"0")},r.asByte=function(t){return r.asHex(t).padStart(2,"0")},r.bytesToString=function(t){return t.reduce(function(t,e){return t+r.asByte(e)},"")}},{}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicBytecode"),i=function(){function e(t){if(!e.isFormat1(t.op))throw new Error(t.op+" is not a format 1 operation");if(""!==t.args)throw new Error("Format 1 arguments cannot have arguments");this.bc=n.bytecodeTable[t.op]}return e.isFormat1=function(t){var e=n.bytecodeTable[t];return void 0!==e&&1===e.format},e.prototype.ready=function(){return!0},e.prototype.makeReady=function(t,e,r){},e.prototype.length=function(){return 1},e.prototype.toBytes=function(){return[this.bc.opcode]},e}();r.SicFormat1=i},{"./SicBytecode":2}],7:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./SicBytecode"),o=t("./SicRegConvert"),a=t("./SicUnsigned"),n=function(){function n(t){if(!n.isFormat2(t.op))throw new Error(t.op+" is not a format 2 opcode");this.bc=i.bytecodeTable[t.op];var e=t.args.trim().split(/\s*,\s*/);if(1===e.length&&e.push("0"),2!==e.length)throw new Error("This format 2 instruction has an invalid number of operands.");var r=function(t){var e,r=new RegExp("^(A|X|L|PC|SW|B|S|T|F)$"),n=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^([0-9]+)$");if(null!==(e=t.match(r)))return o.sicRegToDec(e[1]);if(null!==(e=t.match(n)))return parseInt(e[1],16);if(null!==(e=t.match(i)))return parseInt(e[1],10);throw new Error(t+" is not a valid format 2 operand.")};this.op1=r(e[0]),a.sicCheckUnsigned(this.op1,4),this.op2=r(e[1]),a.sicCheckUnsigned(this.op2,4)}return n.isFormat2=function(t){var e=i.bytecodeTable[t];return void 0!==e&&2===e.format},n.prototype.ready=function(){return!0},n.prototype.makeReady=function(t,e,r){},n.prototype.length=function(){return 2},n.prototype.toBytes=function(){var t=[0,0];return t[0]=this.bc.opcode,t[1]|=(15&this.op1)<<4,t[1]|=15&this.op2,t},n}();r.SicFormat2=n},{"./SicBytecode":2,"./SicRegConvert":16,"./SicUnsigned":19}],8:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicBytecode"),i=t("./SicOperandAddr"),o=function(){function r(t,e){if(!r.isFormat3(t.op))throw new Error(t.op+" is not format 3");this.bc=n.bytecodeTable[t.op],this.op=new i.SicOperandAddr(t.args,i.SicOpType.f3,e)}return r.isFormat3=function(t){var e=n.bytecodeTable[t];return void 0!==e&&3===e.format},r.prototype.makeReady=function(t,e,r){this.op.makeReady(t+3,e,r)},r.prototype.ready=function(){return this.op.ready()},r.prototype.length=function(){return 3},r.prototype.toBytes=function(){if(!this.ready())throw new Error("Internal error: This SicFormat3 instruction is not ready.");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(3840&this.op.val)>>>8,t[2]=255&this.op.val,t},r}();r.SicFormat3=o},{"./SicBytecode":2,"./SicOperandAddr":14}],9:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicBytecode"),i=t("./SicOperandAddr"),o=function(){function r(t,e){if(!r.isFormat4(t.op))throw new Error(t.op+" is not format 4");this.bc=n.bytecodeTable[t.op.slice(1)],this.op=new i.SicOperandAddr(t.args,i.SicOpType.f4,e)}return r.isFormat4=function(t){if("+"!==t.charAt(0))return!1;var e=n.bytecodeTable[t.slice(1)];return void 0!==e&&3===e.format},r.prototype.makeReady=function(t,e,r){this.op.makeReady(t+this.length(),e,r)},r.prototype.ready=function(){return this.op.ready()},r.prototype.length=function(){return 4},r.prototype.toBytes=function(){if(!this.ready())throw new Error("Internal error: This SicFormat4 instruction is not ready.");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(983040&this.op.val)>>>16,t[2]=(65280&this.op.val)>>>8,t[3]=255&this.op.val,t},r}();r.SicFormat4=o},{"./SicBytecode":2,"./SicOperandAddr":14}],10:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicBytecode"),i=t("./SicOperandAddr"),o=function(){function r(t,e){if(!r.isFormatLegacy(t.op))throw new Error(t.op+" is not SIC legacy format");this.bc=n.bytecodeTable[t.op.slice(1)],this.op=new i.SicOperandAddr(t.args,i.SicOpType.legacy,e)}return r.isFormatLegacy=function(t){if("*"!==t.charAt(0))return!1;var e=n.bytecodeTable[t.slice(1)];return void 0!==e&&3===e.format},r.prototype.makeReady=function(t,e,r){this.op.makeReady(t+this.length(),e,r)},r.prototype.ready=function(){return this.op.ready()},r.prototype.length=function(){return 3},r.prototype.toBytes=function(){if(!this.ready())throw new Error("Internal error: This SicFormatLegacy instruction is not ready.");var t=this.op.nixbpe();return t[0]|=252&this.bc.opcode,t[1]|=(32512&this.op.val)>>>8,t[2]=255&this.op.val,t},r}();r.SicFormatLegacy=o},{"./SicBytecode":2,"./SicOperandAddr":14}],11:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(){this.ltorgs=[],this.pending=new Set}return t.prototype.getLitLoc=function(e,r){void 0===r&&(r=0);var n=Number.MAX_SAFE_INTEGER,i=null;return this.ltorgs.forEach(function(t){t.val===e&&n>Math.min(t.loc-r,t.loc)&&(n=Math.min(t.loc-r,t.loc),i=t.loc)}),i},t.prototype.createOrg=function(t){var e=t,r=[];this.pending.forEach(function(t){r.push({loc:e,val:t}),e+=3});return this.ltorgs=this.ltorgs.concat(r),this.pending=new Set,r},t.prototype.add=function(t){null===this.getLitLoc(t)&&this.pending.add(t)},t.prototype.hasPending=function(t){return void 0===t?0<this.pending.size:this.pending.has(t)},t}();r.SicLitTab=n},{}],12:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicSpace"),i=function(){function t(t){this.val=t}return t.prototype.length=function(){return 3},t.prototype.ready=function(){return!0},t.prototype.makeReady=function(t,e,r){},t.prototype.toBytes=function(){return n.SicSpace.splitWord(this.val)},t}();r.SicLiteral=i},{"./SicSpace":17}],13:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicFmt"),i=function(){function t(t,e){this.source=t,this.errmsg="string"==typeof e?(this.bcData=void 0,e):void(this.bcData=e)}return t.prototype.hasInstruction=function(){return void 0!==this.bcData&&void 0!==this.bcData.inst},t.prototype.byteCode=function(){if(void 0===this.bcData||void 0===this.bcData.inst)throw new Error("This SicLstEntry does not have an instruction in it");return this.bcData.inst.toBytes()},t.prototype.byteString=function(){return n.bytesToString(this.byteCode())},t}();r.SicLstEntry=i},{"./SicFmt":5}],14:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l,n,h,i,p=t("./SicPending"),o=t("./SicUnsigned");(n=l=r.SicOpAddrType||(r.SicOpAddrType={}))[n.immediate=0]="immediate",n[n.direct=1]="direct",n[n.indirect=2]="indirect",(i=h=r.SicOpType||(r.SicOpType={}))[i.f3=0]="f3",i[i.f4=1]="f4",i[i.legacy=2]="legacy";var a=function(){function t(t,e,r){var n,i=new RegExp("^(=|#|@)?(\\d+)(,X)?$"),o=new RegExp("^(=|#|@)?X'([0-9A-F]+)'(,X)?$"),a=new RegExp("^(=|#|@)?C'(.{1,3})'(,X)?$"),c=new RegExp("^(#|@)?([A-Z]+)(,X)?$"),s=function(t){return void 0!==t&&"="===t.charAt(0)};if(this.type=e,this.base=this.type===h.f3?r.base:void 0,this.pcrel=this.type===h.f3,null!==(n=t.match(i))){var u=parseInt(n[2],10);s(n[1])?(r.litTab.add(u),this.val=new p.SicPending(u)):(this.val=u,this.pcrel=!1)}else if(null!==(n=t.match(o))){u=parseInt(n[2],16);s(n[1])?(r.litTab.add(u),this.val=new p.SicPending(u)):(this.val=u,this.pcrel=!1)}else if(null!==(n=t.match(a))){for(var d=[],f=0;f<n[2].length;++f)d.push(n[2].charCodeAt(f));for(;d.length<3;)d=[0].concat(d);u=(d[0]<<16)+(d[1]<<8)+d[2];s(n[1])?(r.litTab.add(u),this.val=new p.SicPending(u)):(this.val=u,this.pcrel=!1)}else{if(null==(n=t.match(c)))throw new Error("Operand "+t+" is not of any valid format.");if(r.extRefTab.has(n[2])){if(this.type!==h.f4)throw new Error("EXTREF symbols can only be used with format 4");r.modRecs.push({loc:r.useTab.aloc,len:5,symbol:n[2]}),this.val=0,this.pcrel=!1,this.base=void 0}else this.val=new p.SicPending(n[2])}if(this.addr=function(t){switch(t){case"#":return l.immediate;case"@":return l.indirect;case"=":default:return l.direct}}(n[1]),this.indexed=null!=n[3],this.addr!==l.direct&&this.type===h.legacy)throw new Error("SIC Legacy instructions can only use direct addressing");this.rdy=!this.pcrel&&void 0===this.base&&"number"==typeof this.val}return t.prototype.ready=function(){return this.rdy},t.prototype.makeReady=function(t,e,r){if(!this.rdy){var n;switch(void 0===this.base||this.base.ready()||this.base.makeReady(e),"number"!=typeof this.val&&(this.val=this.val.convert(e,r)),this.type){case h.f3:n=12;break;case h.legacy:n=15;break;case h.f4:n=20;break;default:throw new Error("type is not valid")}if(this.pcrel)try{return this.val=o.sicMakeUnsigned(this.val-t,n),void(this.rdy=!0)}catch(t){this.pcrel=!1}if(this.base)try{return this.val=o.sicMakeUnsigned(this.val-this.base.val,n),void(this.rdy=!0)}catch(t){this.base=void 0}o.sicCheckUnsigned(this.val,n),this.rdy=!0}},t.prototype.nixbpe=function(){if(!this.ready())throw new Error("nixbpe() can only be called when the value is ready.");var t,e,r=this.indexed,n=!this.pcrel&&void 0!==this.base,i=this.pcrel,o=this.type===h.f4;switch(this.addr){case l.direct:e=t=this.type!==h.legacy;break;case l.indirect:e=!(t=!0);break;case l.immediate:e=!(t=!1);break;default:throw new Error("Registers do not have an nixbpe value")}var a=[0,0];return t&&(a[0]|=2),e&&(a[0]|=1),r&&(a[1]|=128),n&&(a[1]|=64),i&&(a[1]|=32),o&&(a[1]|=16),a},t}();r.SicOperandAddr=a},{"./SicPending":15,"./SicUnsigned":19}],15:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t){this.val=t}return t.prototype.isLiteral=function(){return"number"==typeof this.val},t.prototype.isTag=function(){return"string"==typeof this.val},t.prototype.convert=function(t,e){var r;if("number"==typeof this.val){if(null===e)throw new Error("litTab is undefined but this SicPending is a literal");if(null===(r=e.getLitLoc(this.val)))throw new Error(this.val+"was not found in the literal table")}else{if(null===t)throw new Error("tagTab is undefined but this SicPending is a tag");if(null===(r=t[this.val]))throw new Error(this.val+"was not found in the tag table")}return r},t}();r.SicPending=n},{}],16:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sicRegToDec=function(t){switch(t){case"A":return 0;case"X":return 1;case"L":return 2;case"B":return 3;case"S":return 4;case"T":return 5;case"F":return 6;case"PC":return 8;case"SW":return 9;default:throw new Error("reg type "+t+" is not valid")}},r.sicDecToReg=function(t){switch(t){case 0:return"A";case 1:return"X";case 2:return"L";case 3:return"B";case 4:return"S";case 5:return"T";case 6:return"F";case 8:return"PC";case 9:return"SW";default:throw new Error("reg no "+t+" is not valid")}}},{}],17:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./SicUnsigned"),i=function(){function a(t){if(!a.isSpace(t.op))throw new Error("This mnemonic is not a space.");this.mnemonic=t.op;var e,r=new RegExp("^(\\d+)$"),n=new RegExp("^X'([0-9A-Fa-f]+)'$"),i=new RegExp("^C'(.+)'$");if(null!==(e=t.args.match(r)))this.arg=a.splitWord(parseInt(e[1],10));else if(null!==(e=t.args.match(n)))this.arg=a.splitWord(parseInt(e[1],16));else{if(null===(e=t.args.match(i)))throw new Error(t.args+" is not a valid operand format.");this.arg=[];for(var o=0;o<e[1].length;++o)this.arg.push(e[1].charCodeAt(o))}}return a.isSpace=function(t){return new RegExp("^(WORD|BYTE)$").test(t)},a.splitWord=function(t){return n.sicCheckUnsigned(t,24),[(16711680&t)>>>16,(65280&t)>>>8,255&t]},a.prototype.ready=function(){return!0},a.prototype.makeReady=function(t,e,r){},a.prototype.length=function(){switch(this.mnemonic){case"WORD":return this.arg.length+(this.arg.length%3!=0?1:0);case"BYTE":return this.arg.length;default:throw new Error(this.mnemonic+" is invalid. this is a ultra mega bug")}},a.prototype.toBytes=function(){var e=[];switch(this.mnemonic){case"WORD":for(var t=0;t<this.arg.length%3;++t)e.push(0);return this.arg.forEach(function(t){return e.push(t)}),e;case"BYTE":return this.arg;default:throw new Error("Mnemonic is invalid.")}},a}();r.SicSpace=i},{"./SicUnsigned":19}],18:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){var e=(t=t.replace(/\..*$/,"").toUpperCase()).split(/\s+/);if(e.length<=1)throw new Error("This line does not have the correct number of entries. Did you forget to put whitespace before the operand?");if(this.tag=e[0],this.op=e[1],3<=e.length?this.args=e.slice(2).reduce(function(t,e){return t+e},""):this.args="",null===this.tag.match(/^[A-Z]*$/))throw new Error('Labels can only contain A-Z (found "'+this.tag+'")')};r.SicSplit=n},{}],19:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./SicFmt");n.sicMakeMask=function(t){for(var e=0,r=0;r<t;++r)e|=1<<r;return e},n.sicCheckUnsigned=function(t,e){if(t<0||t>n.sicMakeMask(e))throw new Error(i.asHex(t)+" does not fit in an unsigned "+e+"-bit range")},n.sicMakeUnsigned=function(t,e){var r=n.sicMakeMask(e-1);if(t<-r-1||r<t)throw new Error(i.asHex(t)+" does not fit in a signed "+e+"-bit range");return t>>>=0,t&=n.sicMakeMask(e)}},{"./SicFmt":5}],20:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t){this.ALOC=this.RLOC=this.startloc=t,this.useTab={},this.currentUse=""}return Object.defineProperty(t.prototype,"aloc",{get:function(){return this.ALOC},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rloc",{get:function(){return this.RLOC},enumerable:!0,configurable:!0}),t.prototype.inc=function(t){this.RLOC+=t,this.ALOC+=t},t.prototype.use=function(t){this.useTab[this.currentUse]=this.RLOC,this.currentUse=t;var e=this.useTab[t];void 0===e&&(e=this.startloc),this.RLOC=e},t}();r.SicUseTab=n},{}],21:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),t("ace"),t("jquery");var n=t("./SicCompiler/SicCompiler"),i=ace.edit("editor");i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/sicxe"),$("#output").val("");$("#btnCompile").click(function(){try{var t=i.getValue().split("\n"),e=new n.SicCompiler(t),r=["-----lst-----"];r=r.concat(e.makeLst()),r=e.err?r.concat("","","No obj generation due to errors in lst."):(r=r.concat("","","-----obj-----")).concat(e.makeObj()),$("#output").val(r.reduce(function(t,e){return t+"\n"+e}))}catch(t){alert(t.message)}})},{"./SicCompiler/SicCompiler":3,ace:22,jquery:22}],22:[function(t,e,r){},{}]},{},[21])(21)});
//# sourceMappingURL=sicness.min.js.map
